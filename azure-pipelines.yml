trigger:
  batch: true
  branches:
    include:
    - master

pr:
- master

schedules:
- cron: "0 0 * * *"
  displayName: Daily midnight build
  branches:
    include:
    - master

strategy:
  matrix:
    linux:
      imageName: "windows-2019"
      nodeVersion: "12.x"
  maxParallel: 3

pool:
  vmImage: $(imageName)

steps:
- powershell: 'Get-ChildItem env:* | sort-object name'
  displayName: 'Log environment variables'
  continueOnError: true

- task: NodeTool@0
  displayName: 'Use Node 12.x'
  inputs:
    versionSpec: $(nodeVersion)

- task: Npm@1
  displayName: 'Install rush'
  inputs:
    command: custom
    verbose: false
    customCommand: 'install --global @microsoft/rush'

- script: 'rush update'
  displayName: 'rush update'

- script: 'rush build'
  displayName: 'rush build'

- script: 'rush test'
  displayName: 'rush test'

- task: ms.vss-governance-buildtask.governance-build-task-component-detection.ComponentGovernanceComponentDetection@0
  displayName: 'Component Detection'

- script: 'rush report:coverage'
  displayName: 'rush report:coverage'
  enabled: false

- task: PublishBuildArtifacts@1
  enabled: false
  displayName: 'Publish Artifact: nyc_output'
  inputs:
    PathtoPublish: '$(Build.SourcesDirectory)\.nyc_output'
    ArtifactName: 'nyc_output'
